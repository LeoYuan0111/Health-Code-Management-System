<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.healthcodebe.mapper.PlaceCodeMapper">
    <resultMap id="BasePlaceCodeMap" type="com.example.healthcodebe.entity.PlaceCode">
        <result column="place_id" property="placeId" jdbcType="INTEGER" />
        <result column="phone_number" property="phoneNumber" jdbcType="VARCHAR" />
        <result column="longitude" property="longitude" jdbcType="DOUBLE" />
        <result column="latitude" property="latitude" jdbcType="DOUBLE" />
        <result column="province" property="province" jdbcType="VARCHAR" />
        <result column="city" property="city" jdbcType="VARCHAR" />
        <result column="county" property="county" jdbcType="VARCHAR" />
        <result column="village" property="village" jdbcType="VARCHAR" />
        <result column="detail_addr" property="detailAddr" jdbcType="VARCHAR" />
    </resultMap>

    <select id="getPlaceCodeById" resultMap="BasePlaceCodeMap" parameterType="String">
        SELECT
        *
        FROM
        place_code
        <where>
            place_id = #{id}
        </where>
    </select>

    <select id="getNewPlaceCode" resultMap="BasePlaceCodeMap" parameterType="map">
        SELECT
        *
        FROM
        place_code A
        <where>
            A.place_id = (SELECT MAX(place_id) FROM place_code)
        </where>
    </select>

    <insert id="addPlaceCode" useGeneratedKeys="true" keyProperty="placeId" parameterType="com.example.healthcodebe.entity.PlaceCode">
        INSERT INTO place_code
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="phoneNumber != null">phone_number,</if>
            <if test="longitude != null">longitude,</if>
            <if test="latitude != null">latitude,</if>
            province,
            city,
            county,
            village,
            <if test="detailAddr != null">detail_addr,</if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="phoneNumber != null">#{phoneNumber},</if>
            <if test="longitude != null">#{longitude},</if>
            <if test="latitude != null">#{latitude},</if>
            #{province},
            #{city},
            #{county},
            #{village},
            <if test="detailAddr != null">#{detailAddr},</if>
        </trim>
    </insert>

</mapper>
